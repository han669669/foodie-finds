<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>imHungryAF - Influencer Food Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        
        .skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            background-color: #e2e8f0;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .location-pulse {
            animation: pulse 2s infinite, ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        
        @keyframes ping {
            75%, 100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .transition-all {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="flex justify-center items-center gap-3">
                <a href="/" id="logoLink" class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-utensils text-white text-2xl"></i>
                    </div>
                    <h1 class="text-4xl font-bold text-gray-800">imHungryAF</h1>
                </a>
            </div>
            <p class="text-lg text-gray-600 mt-4 ">Discover the best eats recommended by your favorite influencers</p>
        </header>
        
        <!-- App Content -->
        <div id="app">
            <!-- Homepage (Initial State) -->
            <div id="homepage" class="text-center">
                <div class="bg-white rounded-xl shadow-md p-10 mb-8 max-w-md mx-auto">
                    <div class="w-24 h-24 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-utensils text-white text-4xl"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Find Nearby Eats</h2>
                    <p class="text-gray-600 mb-6">Get personalized food recommendations from influencers based on your current location.</p>
                    <button id="findFoodBtn" class="bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white font-medium py-3 px-6 rounded-lg shadow-md transition-all">
                        <i class="fas fa-location-arrow mr-2"></i> Find Food Near Me
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-5 rounded-lg shadow-sm">
                        <div class="text-pink-500 mb-2">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="text-gray-700">"imHungryAF's recommendations never disappoint !"</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm">
                        <div class="text-pink-500 mb-2">
                            <i class="fas fa-route"></i>
                        </div>
                        <p class="text-gray-700">All recommendations within 30 minutes driving distance from you</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm">
                        <div class="text-pink-500 mb-2">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <p class="text-gray-700">Only places personally reviewed by food influencers</p>
                    </div>
                </div>
            </div>
            
            <!-- Location Permission Modal -->
            <div id="locationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
                <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-map-marker-alt text-blue-500 text-2xl location-pulse"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Enable Location Access</h3>
                        <p class="text-gray-600">We need your location to find the best food spots near you. Your data is never stored or shared.</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button id="denyLocationBtn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition-all">
                            Not Now
                        </button>
                        <button id="allowLocationBtn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-all">
                            Allow Location
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="hidden">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-spinner text-blue-500 text-2xl animate-spin"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Finding the best eats near you</h2>
                    <p class="text-gray-600">We're searching imHungryAF's recommendations in your area...</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Skeleton Loaders -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full skeleton"></div>
                            <div class="ml-3">
                                <div class="w-32 h-4 skeleton mb-2"></div>
                                <div class="w-24 h-3 skeleton"></div>
                            </div>
                        </div>
                        <div class="w-full h-4 skeleton mb-2"></div>
                        <div class="w-3/4 h-4 skeleton mb-4"></div>
                        <div class="w-24 h-3 skeleton"></div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full skeleton"></div>
                            <div class="ml-3">
                                <div class="w-32 h-4 skeleton mb-2"></div>
                                <div class="w-24 h-3 skeleton"></div>
                            </div>
                        </div>
                        <div class="w-full h-4 skeleton mb-2"></div>
                        <div class="w-3/4 h-4 skeleton mb-4"></div>
                        <div class="w-24 h-3 skeleton"></div>
                    </div>
                </div>
            </div>
            
            <!-- Results Page -->
            <div id="resultsPage" class="hidden">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-7">
                    <h2 class="text-xl md:text-3xl font-semibold text-gray-900 mb-4 md:mb-0 flex items-center gap-2">
                        <i class="fas fa-map-marker-alt text-blue-500"></i>
                        <span>Nearby Recommendations</span>
                    </h2>
                    <div class="flex items-center">
                        <span class="text-sm text-gray-500 mr-2">Sorted by:</span>
                        <div class="relative">
                            <select class="appearance-none bg-white border border-gray-300 rounded-lg pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="nearest">Distance (nearest first)</option>
                                <option value="furthest">Distance (furthest first)</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="resultsContainer" class="grid grid-cols-1 gap-6">
                    <!-- Results will be inserted here by JavaScript -->
                </div>
                
                <div class="mt-8 text-center">
                    <button id="backToHomeBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-6 rounded-lg transition-all">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Home
                    </button>
                </div>
            </div>
            
            <!-- Error State -->
            <div id="errorState" class="hidden">
                <div class="bg-white rounded-xl shadow-md p-8 max-w-md mx-auto text-center">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Location Access Required</h3>
                    <p class="text-gray-600 mb-6">We couldn't access your location. Please enable location services in your browser settings to get personalized recommendations.</p>
                    <button id="tryAgainBtn" class="bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white font-medium py-2 px-6 rounded-lg shadow-md transition-all">
                        <i class="fas fa-sync-alt mr-2"></i> Try Again
                    </button>
                </div>
            </div>
            
            <!-- No Results State -->
            <div id="noResultsState" class="hidden">
                <div class="bg-white rounded-xl shadow-md p-8 max-w-md mx-auto text-center">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-search text-yellow-500 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">No Nearby Spots Found</h3>
                    <p class="text-gray-600 mb-6">We couldn't find any imHungryAF recommended places within 30 minutes of your location. Check back later as we add more recommendations !</p>
                    <button id="backToHomeBtn2" class="bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white font-medium py-2 px-6 rounded-lg shadow-md transition-all">
                        <i class="fas fa-home mr-2"></i> Back to Home
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-16 text-center text-gray-500 text-sm">
            <p>© 2025 imHungryAF. All food recommendations are reviewed by influencers, data manually curated by me.</p>
            <p class="mt-3">This application uses your current location to find nearby recommendations within a 30-minute drive at an average speed of 60 km/h. Your location data is not stored as it is unnecessary.</p>
            <br>
            <small>Vincenty formula used for calculating the distance between two points on the Earth's surface given their latitude and longitude. It is more accurate than Haversine formula for small distances and takes into account the Earth's ellipsoidal shape. Learn more <a href="https://community.esri.com/t5/coordinate-reference-systems-blog/distance-on-an-ellipsoid-vincenty-s-formulae/ba-p/902053" target="_blank" class="text-blue-500 hover:underline">here</a>.</small>
        </footer>
    </div>

    <script>
        // Sample data - in a real app this would come from an API
        const foodPlaces = [
            {
            id: "1",
            name: "Spicy Noodle House",
            influencer: "FoodieEmma",
            coordinates: { lat: 40.7128, lng: -74.0060 },
            rating: 5,
            review: "The dan dan noodles here are absolutely incredible! Perfect spice level and the noodles have the perfect chew.",
            image: "https://images.unsplash.com/photo-1555126634-323283dd4c54?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
            },
            {
            id: "2",
            name: "Sushi Haven",
            influencer: "FoodieEmma",
            coordinates: { lat: 40.7200, lng: -74.0100 },
            rating: 4,
            review: "Their omakase is a steal for the quality. The toro melts in your mouth like butter!",
            image: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
            },
            {
            id: "3",
            name: "The Burger Joint",
            influencer: "FoodieEmma",
            coordinates: { lat: 40.7150, lng: -74.0050 },
            rating: 4,
            review: "Juicy, messy, delicious. Their secret sauce makes these burgers next level.",
            image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
            },
            {
            id: "4",
            name: "Pizza Palace",
            influencer: "FoodieEmma",
            coordinates: { lat: 40.7080, lng: -74.0150 },
            rating: 5,
            review: "The perfect NY slice - thin crust, slightly charred, with the right cheese-to-sauce ratio.",
            image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
            },
            {
            id: "5",
            name: "Taco Fiesta",
            influencer: "FoodieEmma",
            coordinates: { lat: 40.7050, lng: -74.0080 },
            rating: 4,
            review: "Authentic street-style tacos with homemade tortillas. The al pastor is a must-try!",
            image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
            },
            {
            id: "6",
            name: "Chilli Crab Delight",
            influencer: "FoodieEmma",
            coordinates: { lat: 1.2800, lng: 103.8500 },
            rating: 5,
            review: "The best chilli crab in Singapore! The sauce is rich and flavorful, perfect with mantou.",
            image: "https://upload.wikimedia.org/wikipedia/commons/c/c6/Chilli_crab-02.jpg"
            },
            {
            id: "7",
            name: "Hainanese Chicken Rice Corner",
            influencer: "FoodieEmma",
            coordinates: { lat: 1.2833, lng: 103.8333 },
            rating: 4,
            review: "Tender chicken with fragrant rice and a trio of sauces that elevate the dish.",
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Hainanese_Chicken_Rice_in_Hong_Kong_Singaporean_Restaurant.jpg/1440px-Hainanese_Chicken_Rice_in_Hong_Kong_Singaporean_Restaurant.jpg"
            },
            {
            id: "8",
            name: "Laksa Paradise",
            influencer: "FoodieEmma",
            coordinates: { lat: 1.3000, lng: 103.8500 },
            rating: 5,
            review: "A bowl of creamy, spicy laksa that hits all the right notes. The prawns are fresh and juicy.",
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Nyonya_Laksa.jpg/960px-Nyonya_Laksa.jpg"
            }
        ];

        let currentResults = [];

        // DOM Elements
        const homepage = document.getElementById('homepage');
        const locationModal = document.getElementById('locationModal');
        const loadingState = document.getElementById('loadingState');
        const resultsPage = document.getElementById('resultsPage');
        const errorState = document.getElementById('errorState');
        const noResultsState = document.getElementById('noResultsState');
        const resultsContainer = document.getElementById('resultsContainer');
        
        // Buttons
        const findFoodBtn = document.getElementById('findFoodBtn');
        const allowLocationBtn = document.getElementById('allowLocationBtn');
        const denyLocationBtn = document.getElementById('denyLocationBtn');
        const tryAgainBtn = document.getElementById('tryAgainBtn');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        const backToHomeBtn2 = document.getElementById('backToHomeBtn2');

        // Event Listeners
        findFoodBtn.addEventListener('click', showLocationModal);
        allowLocationBtn.addEventListener('click', requestLocation);
        denyLocationBtn.addEventListener('click', hideLocationModal);
        tryAgainBtn.addEventListener('click', requestLocation);
        backToHomeBtn.addEventListener('click', resetToHomepage);
        backToHomeBtn2.addEventListener('click', resetToHomepage);

        // Sort dropdown change event
        document.querySelector('select').addEventListener('change', () => {
            sortAndDisplayResults();
        });

        // Show location permission modal
        function showLocationModal() {
            locationModal.classList.remove('hidden');
        }

        // Hide location permission modal
        function hideLocationModal() {
            locationModal.classList.add('hidden');
        }

        // Request user's location
        function requestLocation() {
            hideLocationModal();
            homepage.classList.add('hidden');
            loadingState.classList.remove('hidden');
            
            // Simulate loading delay
            setTimeout(() => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            // Success - got location
                            const userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            console.log('Detected user location:', userLocation.lat, userLocation.lng);
                            processRecommendations(userLocation);
                        },
                        error => {
                            // Error getting location
                            showErrorState();
                        }
                    );
                } else {
                    // Geolocation not supported
                    showErrorState();
                }
            }, 1500);
        }

        // Process recommendations based on user location
        function processRecommendations(userLocation) {
            // Calculate distances and filter places within 30 km
            currentResults = foodPlaces.map(place => {
                const distanceKm = calculateDistance(
                    userLocation.lat,
                    userLocation.lng,
                    place.coordinates.lat,
                    place.coordinates.lng
                );
                
                return {
                    ...place,
                    distanceKm: distanceKm,
                    minutesAway: Math.round(distanceKm)
                };
            }).filter(place => place.distanceKm <= 30);
            
            sortAndDisplayResults();
            
            // Hide loading state
            loadingState.classList.add('hidden');
            
            if (currentResults.length > 0) {
                resultsPage.classList.remove('hidden');
            } else {
                noResultsState.classList.remove('hidden');
            }
        }

        function sortAndDisplayResults() {
            const sortSelect = document.querySelector('select');
            const sortValue = sortSelect.value;

            let sortedResults = [...currentResults];

            if (sortValue === 'nearest') {
                sortedResults.sort((a, b) => a.distanceKm - b.distanceKm);
            } else if (sortValue === 'furthest') {
                sortedResults.sort((a, b) => b.distanceKm - a.distanceKm);
            }

            displayResults(sortedResults);
        }

        // Display results
        function displayResults(places) {
            resultsContainer.innerHTML = '';
            
            places.forEach(place => {
                const placeCard = document.createElement('div');
                placeCard.className = 'bg-white rounded-xl shadow-sm overflow-hidden transition-all card-hover';
                placeCard.innerHTML = `
                    <div class="md:flex">
                        <div class="md:w-1/3 h-48 md:h-auto">
                            <img src="${place.image}" alt="${place.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6 md:w-2/3 flex items-center justify-center flex-col">
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-2 w-full">
                                <h3 class="text-xl font-semibold text-gray-800">${place.name}</h3>
                                <span class="mt-4 mb-3 sm:mt-0 bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full sm:inline-block text-center">
                                    ${place.minutesAway} mins away
                                </span>
                            </div>
                            
                            <div class="flex items-center mb-4 w-full">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-orange-500 flex items-center justify-center text-white">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-800">imHungryAF</p>
                                    <div class="flex">
                                        ${Array(place.rating).fill('<i class="fas fa-star text-yellow-400 text-xs"></i>').join('')}
                                        ${Array(5 - place.rating).fill('<i class="far fa-star text-yellow-400 text-xs"></i>').join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <p class="text-gray-600 text-sm mb-4 text-center">"${place.review}"</p>
                            
                            <div class="flex justify-between items-center w-full">
                                <span class="text-xs text-gray-500">
                                    <i class="fas fa-map-marker-alt mr-1"></i> ${place.distanceKm.toFixed(2)} km
                                </span>
                                <button class="text-sm font-medium text-pink-500 hover:text-pink-600 transition-all">
                                    View Details <i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                resultsContainer.appendChild(placeCard);
            });
        }

        // Show error state
        function showErrorState() {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
        }

        // Reset to homepage
        function resetToHomepage() {
            homepage.classList.remove('hidden');
            resultsPage.classList.add('hidden');
            errorState.classList.add('hidden');
            noResultsState.classList.add('hidden');
        }

        // Helper function to calculate distance between two coordinates using Vincenty formula
        // This formula is more accurate than Haversine for small distances and takes into account the Earth's ellipsoidal shape.
        // Reference: https://en.wikipedia.org/wiki/Vincenty%27s_formulae
        // This function calculates the distance between two points on the Earth's surface given their latitude and longitude.
        // It uses the Vincenty formula, which is more accurate than the Haversine formula for small distances.
        // The function takes four parameters: lat1, lon1 (coordinates of the first point) and lat2, lon2 (coordinates of the second point).
        // The function returns the distance in kilometers.
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const a = 6378137; // Semi-major axis of the Earth in meters
            const f = 1 / 298.257223563; // Flattening of the Earth
            const b = 6356752.314245; // Semi-minor axis of the Earth in meters

            const toRadians = angle => angle * Math.PI / 180;

            const φ1 = toRadians(lat1);
            const φ2 = toRadians(lat2);
            const L = toRadians(lon2 - lon1);

            const U1 = Math.atan((1 - f) * Math.tan(φ1));
            const U2 = Math.atan((1 - f) * Math.tan(φ2));

            const sinU1 = Math.sin(U1), cosU1 = Math.cos(U1);
            const sinU2 = Math.sin(U2), cosU2 = Math.cos(U2);

            let λ = L, λPrev, iterLimit = 100;
            let sinλ, cosλ, sinσ, cosσ, σ, sinα, cos2α, cos2σm, C;

            do {
            sinλ = Math.sin(λ);
            cosλ = Math.cos(λ);
            sinσ = Math.sqrt(
                (cosU2 * sinλ) * (cosU2 * sinλ) +
                (cosU1 * sinU2 - sinU1 * cosU2 * cosλ) *
                (cosU1 * sinU2 - sinU1 * cosU2 * cosλ)
            );
            if (sinσ === 0) return 0; // Co-located points
            cosσ = sinU1 * sinU2 + cosU1 * cosU2 * cosλ;
            σ = Math.atan2(sinσ, cosσ);
            sinα = cosU1 * cosU2 * sinλ / sinσ;
            cos2α = 1 - sinα * sinα;
            cos2σm = cosσ - 2 * sinU1 * sinU2 / cos2α;
            if (isNaN(cos2σm)) cos2σm = 0; // Equatorial line
            C = f / 16 * cos2α * (4 + f * (4 - 3 * cos2α));
            λPrev = λ;
            λ = L + (1 - C) * f * sinα * (
                σ + C * sinσ * (
                cos2σm + C * cosσ * (
                    -1 + 2 * cos2σm * cos2σm
                )
                )
            );
            } while (Math.abs(λ - λPrev) > 1e-12 && --iterLimit > 0);

            if (iterLimit === 0) return NaN; // Formula failed to converge

            const uSquared = cos2α * (a * a - b * b) / (b * b);
            const A = 1 + uSquared / 16384 * (4096 + uSquared * (-768 + uSquared * (320 - 175 * uSquared)));
            const B = uSquared / 1024 * (256 + uSquared * (-128 + uSquared * (74 - 47 * uSquared)));
            const Δσ = B * sinσ * (
            cos2σm + B / 4 * (
                cosσ * (-1 + 2 * cos2σm * cos2σm) -
                B / 6 * cos2σm * (-3 + 4 * sinσ * sinσ) * (-3 + 4 * cos2σm * cos2σm)
            )
            );

            const distance = b * A * (σ - Δσ);
            return distance / 1000; // Convert to kilometers
        }
        // uses Haversine formula, which is widely used to calculate the great-circle distance between two points on the Earth's surface.
        // function calculateDistance(lat1, lon1, lat2, lon2) {
        //     const R = 6371;
        //     const dLat = (lat2 - lat1) * Math.PI / 180;
        //     const dLon = (lon2 - lon1) * Math.PI / 180;
        //     const a =
        //         Math.sin(dLat/2) * Math.sin(dLat/2) +
        //         Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        //         Math.sin(dLon/2) * Math.sin(dLon/2);
        //     const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        //     const distance = R * c;
        //     return distance;
        // }
    </script>
</body>
</html>